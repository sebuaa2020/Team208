# 建图模块单元测试文档

## API测试

该部分主要对建图模块中重要的`API`进行白盒测试

1. 雷达过滤函数`lidarCallback`:

   * 函数功能：保证建图过程雷达扫描的有效距离均大于`0.25m`，以确保基于该地图的`acml`定位算法运行准确

   * 输入：雷达一次扫描的数据，格式如下：

     |          字段           |         含义         |
     | :---------------------: | :------------------: |
     |    float32 angle_min    |    开始扫描的角度    |
     |    float32 angle_max    |    结束扫描的角度    |
     | float32 angle_increment | 每一次扫描增加的角度 |
     | float32 time_increment  |    测量的时间间隔    |
     |    float32 scan_time    |    扫描的时间间隔    |
     |    float32 range_min    |      距离最小值      |
     |    float32 range_max    |      距离最大值      |
     |    float32[] ranges     |       距离数组       |
     |  float32[] intensities  |       强度数组       |

   * 输出：过滤之后的数据，其中格式同输入数据，保证`ranges[i] > 0.25`

## 节点功能测试

该部分主要对建图模块中重要的节点依赖的`topic`进行黑盒测试

该模块主要测试`slam_gmapping`节点是否正常工作

1. 该节点订阅的雷达扫描数据来源`/robot2077/slam/scan`（过滤之后的）

   * 测试方法：正常运行模块，设置`testSlamScan`节点监听该`topic`，检查数据是否符合要求
   * 数据要求：数据格式同上雷达数据格式
     1. `rang[i] > 0.25`
     2. `range_max > range_min`
     3. `ranges[]`不为空

2. 该节点发布的地图数据`map`

   * 测试方法：使用`testSlamMap`节点监听

   * 数据要求：数据格式如下：

     |       字段       |                    |         含义         |
     | :--------------: | :----------------: | :------------------: |
     | MapMetaData info | float32 resolution |        分辨率        |
     |                  |    uint32 width    |         宽度         |
     |                  |   uint32 height    |         长度         |
     |   int8[] data    |                    | 地图数据，行优先存储 |

     1. `0 <= data[i] <= 100`

## 模块功能测试

该部分主要通过用户运行建图模块操作测试：

要测试：

* 建图过程中雷达是否正常工作，即障碍物轮廓点的出现是否正常
* 建图过程中控制运行时机器人是否可以正常运动以及动态避障

