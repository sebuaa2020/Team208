# Test-Basic

- [ ] `RobotMove`
- [ ] `RobotAvoidance`

## RobotMove

该模块介绍与运行方法参考`robot2077_basic`包中`README`文件。

由于该模块没有与用户直接交互的接口，所以主要测试为：

- [ ] 单元测试
- [ ] 节点测试

测试方法：

- 单元测试：构造测试样例，向函数`move_listen`输入测试样例，然后检测`vel_temp`的变化。

  输入：Movemsg消息

  | 字段      | 意义                 |
  | --------- | -------------------- |
  | Movemsg.x | 机器人前后移动线速度 |
  | Movemsg.y | 机器人左右移动线速度 |
  | Movemsg.z | 机器人左右旋转角速度 |

  输出：vel_temp值

  | 字段               | 结果                                                         |
  | ------------------ | ------------------------------------------------------------ |
  | vel_temp.linear.x  | 如果不超过线速度最大值，则与Movemsg.x一致，否则等于速度最大值（正负） |
  | vel_temp.linear.y  | 如果不超过线速度最大值，则与Movemsg.y一致，否则等于速度最大值（正负） |
  | vel_temp.linear.z  | 保持为0                                                      |
  | vel_temp.angular.x | 保持为0                                                      |
  | vel_temp.angular.y | 保持为0                                                      |
  | vel_temp.angular.z | 如果不超过角速度最大值，则与Movemsg.z一致，否则等于速度最大值（正负） |

  需保证：`vel_temp`中的速度始终没有超过设定最大速度，并需覆盖`check_vel`函数中的所有分支。

- 节点测试：使用黑箱测试，向`RobotMove`节点发送`Movemsg`消息，然后监听`/cmd_vel`话题，查看`RobotMove`的输出。

  需保证：`/cmd_vel`中的速度始终没有超过设定最大速度，并且使用`rqt_graph`检测保证只有`RobotMove`可以向`/cmd_vel`发送消息。

需反馈：

- 移动控制模块是否运行正常
- 移动速度参数是否设置合理

## RobotAvoidance

该模块运行需要经模拟，故主要进行：

- [ ] 单元测试
- [ ] 节点测试

测试方法：

- 单元测试：对`getTheta`函数进行测试，构造测试样例，保证分支覆盖。

  输入：

  | 字段 | 意义         |
  | ---- | ------------ |
  | x    | 前后移动速度 |
  | y    | 左右移动速度 |

  输出：

  | 字段  | 意义           | 结果                                                         |
  | ----- | -------------- | ------------------------------------------------------------ |
  | Theta | 机器人移动角度 | 范围在（-180, 180]之间，以向前移动为0，向左移动为90，向右移动为-90 |

- 节点测试：开启模拟器、主动控制模块、移动控制与避障模块。控制机器人向障碍物或墙壁移动，监听避障模块的返回值`k`，保证其取值范围为`[0,1]`，并检测其值变化是否正常。同时需检查机器人是否能够及时减速或停止移动，以及停止后离障碍物的位置。在停止后，如果换一个方向移动（无障碍物），机器人可以正常启动。

需反馈：

- 避障模块是否运行正常
- 避障参数是否设置合理